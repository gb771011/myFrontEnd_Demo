<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <title>016-data</title>
</head>

<body>
    <h1>Hello 016-data</h1>
    <!--<textarea id="console" rows="5" cols="" style="width:100%;resize:none"></textarea>-->
    <div id="template" style="display:none">
        <section id="#id">
            <span style="display:inline-block;width:2rem;">#id</span>
            <input class="hh" type="number" value="" placeholder="hh" min="0" max="99">
            <input class="mm" type="number" value="" placeholder="mm" min="0" max="59">
            <input class="ss" type="number" value="1" placeholder="ss" min="0" max="59">
            <button class="btn_set" type="button">Set</button>
            <button class="btn_start" type="button">Start</button>
            <button class="btn_pause" type="button">Pause</button>
            <button class="btn_stop" type="button">Stop</button>
            <button class="btn_reset" type="button">Reset</button>
        </section>
    </div>
    <article id="container"></article>
    <script>
        // 轉換時分秒(hh:mm:ss)為秒(s)
        function hms2s(hh, mm, ss) {
            var hh = (hh === "") ? 0 : parseInt(hh),
                mm = (mm === "") ? 0 : parseInt(mm),
                ss = (ss === "") ? 0 : parseInt(ss);
            return hh * 3600 + mm * 60 + ss;
        }
        // 轉換秒(s)為時分秒[hh,mm,ss]
        function s2hms(ss) {
            var hh, mm, result;
            ss = (ss === "") ? 0 : parseInt(ss);
            hh = Math.floor(ss / 3600);
            ss -= hh * 3600;
            mm = Math.floor(ss / 60);
            ss -= mm * 60;
            result = [hh,mm,ss];
            return result;
        }

        function Counter() {
            this.times = [],
                this.times_last = [],
                this.mode = [],
                this.init = function (count) {
                    for (i = 0; i < count; i++) {
                        this.times[i] = 0;
                        this.mode[i] = 0;
                    }
                    // console.log("counter.init");
                },
                this.set_times = function (id, hh, mm, ss) {
                    this.times[id] = hms2s(hh, mm, ss);
                    this.times_last[id] = hms2s(hh, mm, ss);
                    console.log("set_times:", id, hms2s(hh, mm, ss));
                },
                this.active = function (id) {
                    this.mode[id] = 1;
                    console.log("active:", id);
                },
                this.pause = function (id) {
                    this.mode[id] = 0;
                    console.log("pause:", id);
                },
                this.stop = function (id) {
                    this.times[id] = 0;
                    this.mode[id] = 0;
                    console.log("stop:", id);
                },
                this.reset = function (id) {
                    this.times[id] = this.times_last[id];
                    console.log("Reset:", id);
                },
                this.run = function () {
                    var i;
                    for (i = 0; i < this.times.length; i++) {
                        (this.times[i] > 0) ? this.times[i] -= this.mode[i] : 0;
                    }
                    console.log("Times:", this.times);
                }
        }
        var counter = new Counter();

        function counterInit(id_template, id_container, times) {
            var i;
            //  資料初始化
            counter.init(times);

            // UI初始化
            for (i = 0; i < times; i++) {
                $(id_container).html(function (index, last) {
                    return last + $(id_template).html().replace(/#id/g, i);
                });
            }
        }

        // 計時器初始化
        counterInit("#template", "#container", 5);
        // 按鈕動作
        $(".btn_set").click(function () {
            var parentId = this.parentNode.id,
                inputs = $("#" + parentId).children("input");
            counter.set_times(parentId, inputs[0].value, inputs[1].value, inputs[2].value);
        });
        $(".btn_start").click(function () {
            var parentId = this.parentNode.id;
            if (counter.times[parentId] > 0) {
                counter.active(parentId);
            } else {
                alert("Set Time First,Please");
            }
            $(this).prop("disabled", true);
        });
        $(".btn_pause").click(function () {
            var parentId = this.parentNode.id;
            counter.pause(parentId);
            $(".btn_start").prop("disabled", false);
        });
        $(".btn_stop").click(function (i) {
            var parentId = this.parentNode.id;
            counter.stop(parentId);
            console.log(i);
        });
        $(".btn_reset").on("click", function (e) {
            var parentId = e.currentTarget.parentElement.id;
            counter.reset(parentId);
        });
        setInterval(function () { counter.run(); }, 1000);
    </script>
</body>

</html>